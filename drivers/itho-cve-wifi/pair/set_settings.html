<form id="set_settings-form" class="homey-form">
    <fieldset class="homey-form-fieldset">
        <legend class="homey-form-legend" data-i18n="pair.authentication"></legend>
        <p class="homey-subtitle" data-i18n="pair.authentication_desc"></p>
        <div class="homey-form-group">
            <label class="homey-form-label" for="username" data-i18n="pair.username"></label>
            <input class="homey-form-input" id="username" name="username" type="text" value="">
        </div>
        <div class="homey-form-group">
            <label class="homey-form-label" for="password" data-i18n="pair.password"></label>
            <input class="homey-form-input" id="password" name="password" type="password" value="">
        </div>
    </fieldset>

    <fieldset class="homey-form-fieldset">
        <legend class="homey-form-legend" data-i18n="pair.settings"></legend>
        <div class="homey-form-group">
            <label class="homey-form-checkbox" for="enableVirtualRemote">
                <input class="homey-form-checkbox-input" id="enableVirtualRemote" name="enableVirtualRemote"
                       type="checkbox"
                       value="true">
                <span class="homey-form-checkbox-checkmark"></span>
                <span class="homey-form-checkbox-text" data-i18n="pair.enableVirtualRemote"></span>
            </label>
            <p class="homey-subtitle" data-i18n="pair.enableVirtualRemote_desc"></p>
        </div>
        <div class="homey-form-group">
            <label class="homey-form-select" for="virtualRemoteType" data-i18n="pair.virtualRemoteType"></label>
            <select class="homey-form-select" name="virtualRemoteType" id="virtualRemoteType">
                <option value="rft-cve">RFT CVE</option>
                <option value="rft-auto" selected>RFT AUTO</option>
                <option value="rft-n">RFT N</option>
                <option value="rft-auto-n">RFT AUTO N</option>
                <option value="rft-df-qf">RFT DF QF</option>
                <option value="rft-rv">RFT RV</option>
                <option value="rft-co2">RFT CO2</option>
                <option value="rft-pir">RFT PIR</option>
                <option value="rft-spider">RFT SPIDER</option>
            </select>
        </div>
        <div class="homey-form-group">
            <label class="homey-form-label" for="refreshInterval" data-i18n="pair.refreshInterval"></label>
            <input class="homey-form-input" id="refreshInterval" name="refreshInterval" type="number" min="5" value="15"
                   required>
        </div>
    </fieldset>
    <div class="homey-form-group">
        <button data-i18n="pair.save" class="homey-button-primary-full"></button>
    </div>
</form>


<script type="text/javascript">!function() {
  const form = document.querySelector('#set_settings-form');

  Homey.setTitle(Homey.__('pair.settings'));

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    Homey.showLoadingOverlay();

    const data = {
      'username': document.querySelector('input[name="username"]').value,
      'password': document.querySelector('input[name="password"]').value,
      'enableVirtualRemote': document.querySelector('input[name="enableVirtualRemote"]').checked,
      'refreshInterval': document.querySelector('input[name="refreshInterval"]').value,
      'virtualRemoteType': document.querySelector('select[name="virtualRemoteType"]').value,
    };

    Homey.emit('set_settings', data)
      .then(function(result) {
        if (result === true) {
          console.log('in progress');
        } else {
          Homey.hideLoadingOverlay();
          Homey.alert(result, 'error');
        }
      });
  });
}();
</script>
