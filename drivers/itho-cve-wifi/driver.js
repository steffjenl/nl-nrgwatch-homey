'use strict';

const Homey = require('homey');
const WebClient = require('../../lib/web-client');

module.exports = class IthoCveWifiDriver extends Homey.Driver {

  /**
   * onInit is called when the driver is initialized.
   */
  async onInit() {
    this.log('IthoCveWifiDriver has been initialized');
  }

  async onPair(session) {
    this.log(session);
    session.setHandler("list_devices", async () => {
      const discoveryStrategy = this.getDiscoveryStrategy();
      const discoveryResults = discoveryStrategy.getDiscoveryResults();

      const devices = Object.values(discoveryResults).map(discoveryResult => {
        this.log('Discovered device:', discoveryResult);
        return {
          name: discoveryResult.host,
          data: {
            id: discoveryResult.host,
          },
          settings: {
            host: discoveryResult.address,
          },
        };
      });

      return devices;
    });
  }
};
